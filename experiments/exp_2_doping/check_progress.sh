#!/bin/bash
# æåŒ–å­ç»“åˆèƒ½è®¡ç®—è¿›åº¦æ£€æŸ¥è„šæœ¬

echo "======================================================================="
echo "ğŸ” æåŒ–å­ç»“åˆèƒ½è®¡ç®— - è¿›åº¦æ£€æŸ¥"
echo "======================================================================="
echo ""

# æ£€æŸ¥è®¡ç®—æ˜¯å¦åœ¨è¿è¡Œ
if pgrep -f "test_polaron_calc.py" > /dev/null; then
    echo "âœ… è®¡ç®—æ­£åœ¨è¿è¡Œä¸­"
else
    echo "âš ï¸  è®¡ç®—æœªè¿è¡Œï¼ˆå¯èƒ½å·²å®Œæˆæˆ–å‡ºé”™ï¼‰"
fi

echo ""
echo "-----------------------------------------------------------------------"
echo "ğŸ“ è¾“å‡ºæ–‡ä»¶çŠ¶æ€:"
echo "-----------------------------------------------------------------------"
ls -lh polaron_calculations/*.inp polaron_calculations/*.out 2>/dev/null || echo "  æš‚æ— è¾“å‡ºæ–‡ä»¶"

echo ""
echo "-----------------------------------------------------------------------"
echo "ğŸ“Š è®¡ç®—è¿›åº¦:"
echo "-----------------------------------------------------------------------"

# æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°èƒ½é‡å€¼
if grep -q "ENERGY| Total FORCE_EVAL" polaron_calculations/*.out 2>/dev/null; then
    echo "âœ… å·²æ‰¾åˆ°èƒ½é‡å€¼:"
    grep "ENERGY| Total FORCE_EVAL" polaron_calculations/*.out | tail -5
else
    echo "â³ SCFè¿­ä»£è¿›è¡Œä¸­..."
    # æ£€æŸ¥SCFæ­¥æ•°
    scf_steps=$(grep "SCF WAVEFUNCTION OPTIMIZATION" polaron_calculations/*.out 2>/dev/null | wc -l)
    if [ "$scf_steps" -gt 0 ]; then
        echo "  SCFæ­¥æ•°: $scf_steps"
    fi
fi

echo ""
echo "-----------------------------------------------------------------------"
echo "ğŸ“ æœ€è¿‘æ—¥å¿— (æœ€å10è¡Œ):"
echo "-----------------------------------------------------------------------"
tail -10 test_polaron_run.log 2>/dev/null || echo "  æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨"

echo ""
echo "======================================================================="
echo "ğŸ’¡ æç¤º:"
echo "  - å®æ—¶ç›‘æ§: tail -f test_polaron_run.log"
echo "  - é‡æ–°æ£€æŸ¥: bash check_progress.sh"
echo "======================================================================="

